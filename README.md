# BigDataSnowflake

## Лабораторная работа №1

**Анализ больших данных — нормализация данных в схему «снежинка»**

Выполнил студент группы М8О-214СВ-24

Красавин М.А.

---

## Исходные данные

В качестве источника использовались CSV-файлы `MOCK_DATA*.csv`:

* всего **10 файлов**
* по **1000 строк** в каждом
* итоговый объём — **10000 записей**

Каждая строка содержит информацию о:

* продаже
* покупателе
* продавце
* товаре
* магазине
* поставщике

Данные исходно находятся в одной денормализованной таблице.

---

## Архитектура решения

Проект развёрнут с использованием **Docker** и **PostgreSQL**.

Используются две основные схемы:

* `stg` — staging-слой для загрузки исходных данных без преобразований
* `dw` — аналитическая витрина данных

---

## Модель данных

### Факт

* `dw.fact_sales` — таблица фактов продаж

  * содержит количественные показатели (sale_quantity, sale_total_price)
  * содержит внешние ключи на измерения

### Измерения

Основные измерения:

* `dw.dim_customer`
* `dw.dim_product`
* `dw.dim_store`
* `dw.dim_seller`
* `dw.dim_supplier`
* `dw.dim_date`

Нормализованные справочники (реализация схемы «снежинка»):

* `dw.dim_country`
* `dw.dim_city`
* `dw.dim_product_category`
* `dw.dim_brand`
* `dw.dim_material`
* `dw.dim_color`
* `dw.dim_size`
* `dw.dim_pet_category`

Таким образом, часть измерений разложена на отдельные справочные таблицы, что уменьшает дублирование данных и соответствует модели снежинки.

---

## Загрузка и трансформация данных

1. Все CSV-файлы загружаются в таблицу `stg.mock_data`.
2. Из staging-таблицы данные распределяются по справочникам и измерениям.
3. После заполнения измерений формируется таблица фактов `dw.fact_sales`.
4. Для дат используется отдельное измерение `dw.dim_date` с календарными атрибутами.

Загрузка и инициализация выполняются автоматически при запуске контейнера PostgreSQL.

---

## Проверка результата

Для проверки корректности модели выполнялись аналитические запросы с использованием JOIN между фактом и измерениями.

Пример запроса: суммарная выручка по странам покупателей:

```sql
SELECT
  co.country_name,
  sum(f.sale_total_price) AS revenue
FROM dw.fact_sales f
JOIN dw.dim_customer c ON c.customer_key = f.customer_key
JOIN dw.dim_country co ON co.country_key = c.country_key
GROUP BY co.country_name
ORDER BY revenue DESC;
```

Данный запрос подтверждает корректность связей между таблицами и демонстрирует работу схемы «снежинка».

---

## Используемые технологии

* PostgreSQL 16
* Docker / Docker Compose
* DBeaver
* SQL (DDL, DML)

---

## Итог

В результате лабораторной работы:

* исходные денормализованные данные преобразованы в аналитическую модель
* реализована схема данных типа «снежинка»
* данные успешно загружены и доступны для аналитических запросов

Полученная модель пригодна для использования в BI-системах и анализа продаж.
